---
title: "a3_part1"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library('pacman')
pacman::p_load(tidyverse, tidymodels, multilevelmod, rstanarm, tidybayes, broom.mixed)
```

# Part I - simulating the data

Use the meta-analysis reported in Parola et al (2020), create a simulated dataset with 100 matched pairs of schizophrenia and controls, each participant producing 10 repeated measures (10 trials with their speech recorded). for each of these "recordings" (data points) produce 10 acoustic measures: 6 from the meta-analysis, 4 with just random noise. Do the same for a baseline dataset including only 10 noise variables. Tip: see the slides for the code.

```{r}
simulate_data <- function(pop_effects, n = 100, n_trails = 10, individual_sd = 1, trail_sd = 0.5, error = 0.2, seed = 1){

  set.seed(seed)
    
  tibble(
    variable = map_chr(seq_along(pop_effects), ~ paste0('v_', .)), 
    population_value = pop_effects) %>% 
  mutate(id = seq(1, n, by = 1) %>% list) %>% 
    unnest(id) %>% 
  rowwise %>%
  mutate(condition = c('sz', 'hc') %>% list,
         true_effect = rnorm(1, population_value, individual_sd) / 2,
         true_effect = c(true_effect, - true_effect) %>% list,
         trail = seq(1, n_trails, by = 1) %>% list) %>% 
    unnest(c(condition, true_effect)) %>% unnest(trail) %>% 
  rowwise %>% 
  mutate(measurment = rnorm(1, true_effect, trail_sd) %>% rnorm(1, ., error),
         across(c(variable, id, condition), as_factor)) %>% 
  relocate(c(variable, population_value), .after = condition)
}
```


```{r}
m_a_values <- c(0.3, 0.4, 0.6, 0.7, 0.65, 0.45, 0.33, 0.23, 0.27, 0.31)

set.seed(1)
informed_pop_effects <- c(sample(m_a_values, 6, replace = F), rep(0, 4))


skeptic_pop_effects <- rep(0, 10)
```


```{r}
dfs_long <- map(list(informed_pop_effects, skeptic_pop_effects), simulate_data)

names(dfs_long) <- c('informed', 'skeptic')

head(dfs_long[[1]])
head(dfs_long[[2]])
```
#```{r}
#checking whether the simulation works fine

check <- map(list(informed_pop_effects, skeptic_pop_effects), ~ simulate_data(pop_effects = .x, n = 1000))



check[[1]] %>% 
  group_by(variable) %>% 
  summarise(mean = true_effect %>% mean, sd = true_effect %>% sd) %>% 
    mutate(true_mean = population_value, 
           true_sd = 1)

check[[1]] %>% 
  group_by(id) %>% 
  summarise(mean = measurment %>% mean, sd = measurment %>% sd) %>% 
    mutate(true_mean = true_effect)
#```


```{r}
#visualising the simulated data


map(dfs_long,
    ~ .x %>% 
      ggplot(aes(x = measurment, fill = condition)) +
        geom_density()+
        facet_wrap(vars(variable))
)
```

```{r}
dfs_wide <- map(dfs_long,
  ~ .x %>% 
      pivot_wider(id_cols = c(id, trail, condition),
                  names_from = variable,
                  values_from = measurment)
)
head(dfs_wide[[1]])
head(dfs_wide[[2]])
```
```{r}

```

